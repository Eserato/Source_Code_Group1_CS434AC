<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Danh Sách Đơn Hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Roboto:ital,wght@0,700;1,700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-200 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gray-200 border-b border-gray-300">
      <div
        class="max-w-7xl mx-auto flex justify-between items-center px-6 py-4"
      >
        <h1 class="logo-font text-2xl text-black select-none">2.Page</h1>
        <div class="flex space-x-6 text-black text-xl">
          <button aria-label="User account" class="focus:outline-none">
            <i class="fas fa-user"></i>
          </button>
          <button aria-label="Language or global" class="focus:outline-none">
            <i class="fas fa-globe"></i>
          </button>
        </div>
      </div>
      <nav
        class="max-w-7xl mx-auto flex space-x-10 px-6 py-2 text-gray-700 font-semibold text-sm select-none"
      >
        <a href="#" class="font-bold text-gray-900">Danh Sách Đơn Hàng</a>
        <a href="#" class="hover:underline">Dashboard</a>
        <a href="#" class="hover:underline">QL Sách</a>
        <a href="#" class="hover:underline">QL Danh Mục</a>
        <a href="#" class="hover:underline">QL Khách Hàng</a>
        <a href="#" class="hover:underline">QL Tài Khoản</a>
        <a href="#" class="hover:underline">QL Kho</a>
      </nav>
    </header>

    <!-- Main content -->
    <main
      class="flex-grow max-w-7xl mx-auto bg-gray-300 rounded-3xl p-6 mt-6 mb-4 flex flex-col"
    >
      <section
        class="bg-gray-300 rounded-3xl p-6 flex flex-col space-y-4"
        aria-label="Order list section"
        id="orders-section"
      >
        <div class="flex justify-between items-center mb-2 select-none">
          <h2 class="font-bold text-lg text-gray-900">Danh Sách Đơn Hàng</h2>
          <div class="flex space-x-3">
            <!-- Bộ lọc ngày -->
            <input
              type="date"
              id="filter-date"
              class="filter-input border rounded px-2"
            />
            <!-- Bộ lọc trạng thái -->
            <select id="filter-status" class="filter-input border rounded px-2">
              <option value="">Tất cả</option>
              <option>Đang Xử lí</option>
              <option>Đang Vận Chuyển</option>
              <option>Đã Giao</option>
            </select>
            <button
              onclick="loadOrders()"
              class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              Lọc
            </button>
          </div>
        </div>

        <!-- Header row -->
        <div
          class="grid grid-cols-7 bg-gray-100 rounded-md py-2 px-4 text-xs font-bold text-gray-900 select-none"
        >
          <div>Mã Đơn Hàng</div>
          <div>Mã Khách Hàng</div>
          <div class="col-span-2">Địa Chỉ</div>
          <div>Ngày Đặt Hàng</div>
          <div>Tổng Tiền</div>
          <div>Trạng Thái</div>
        </div>

        <!-- Orders sẽ được render bằng JS -->
        <div id="orders-container"></div>
      </section>
    </main>

    <footer class="text-center text-gray-700 font-bold pb-4 select-none">
      © Page to Page BookStore
    </footer>

    <script>
      const API_URL = "http://localhost:5000/api/DonHang";

      async function loadOrders() {
        const date = document.getElementById("filter-date").value;
        const status = document.getElementById("filter-status").value;
        let url = API_URL;

        const params = [];
        if (date) params.push("ngay=" + date);
        if (status) params.push("trangThai=" + encodeURIComponent(status));
        if (params.length > 0) url += "?" + params.join("&");

        const container = document.getElementById("orders-container");
        container.innerHTML = `<div class="text-center py-4 text-gray-600">Đang tải...</div>`;

        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error("HTTP Error " + response.status);

          const orders = await response.json();
          container.innerHTML = "";

          if (orders.length === 0) {
            container.innerHTML = `<div class="text-center py-4 text-gray-600">Không có đơn hàng</div>`;
            return;
          }

          orders.forEach((o) => {
            container.innerHTML += `
              <div class="grid grid-cols-7 bg-white rounded-xl py-4 px-6 text-xs text-gray-900 mb-2 hover:shadow">
                <div>#${o.maDonHang}</div>
                <div>${o.maKhachHang}</div>
                <div class="col-span-2">${o.diaChi}</div>
                <div>${new Date(o.ngayDatHang).toLocaleDateString(
                  "vi-VN"
                )}</div>
                <div>${Number(o.tongTien).toLocaleString("vi-VN")} VND</div>
                <div><span class="font-semibold">${o.trangThai}</span></div>
              </div>
            `;
          });
        } catch (err) {
          console.error("Lỗi load đơn hàng:", err);
          container.innerHTML = `<div class="text-center py-4 text-red-600">Không thể tải dữ liệu</div>`;
        }
      }

      // load lần đầu
      loadOrders();
    </script>
  </body>
</html>
